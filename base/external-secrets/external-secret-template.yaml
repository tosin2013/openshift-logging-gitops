apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: logging-loki-aws
  namespace: openshift-logging
spec:
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: logging-loki-aws
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        access_key_id: "{{ .access_key_id }}"
        access_key_secret: "{{ .access_key_secret }}"
        bucketnames: "{{ .bucketnames }}"
        endpoint: "https://s3.{{ .region }}.amazonaws.com"
        region: "{{ .region }}"
        forcepathstyle: "false"
  data:
  - secretKey: access_key_id
    remoteRef:
      key: REPLACE_WITH_ENVIRONMENT_SECRET_NAME  # Override in overlays
      property: access_key_id
  - secretKey: access_key_secret
    remoteRef:
      key: REPLACE_WITH_ENVIRONMENT_SECRET_NAME  # Override in overlays
      property: access_key_secret
  - secretKey: bucketnames
    remoteRef:
      key: REPLACE_WITH_ENVIRONMENT_SECRET_NAME  # Override in overlays
      property: bucketnames
  - secretKey: endpoint
    remoteRef:
      key: REPLACE_WITH_ENVIRONMENT_SECRET_NAME  # Override in overlays
      property: endpoint
  - secretKey: region
    remoteRef:
      key: REPLACE_WITH_ENVIRONMENT_SECRET_NAME  # Override in overlays
      property: region
  - secretKey: forcepathstyle
    remoteRef:
      key: REPLACE_WITH_ENVIRONMENT_SECRET_NAME  # Override in overlays
      property: forcepathstyle
